<div id="issue_templates_settings">
<%
@issue_templates_setting = IssueTemplateSetting.find_or_create(@project.id)
@global_issue_templates = GlobalIssueTemplate.all
 %>
  <% if @project.trackers.blank? %>
      <div class="nodata">
        <%= simple_format(l(:text_no_tracker_enabled)) %>
      </div>
  <% end %>

  <h3><%= l :link_to_index_edit_template %></h3>

  <div class="box">
    <p>
      <%= link_to(l(:label_list_templates),
                  project_issue_templates_path(@project),
                  :class => 'template') %>
      <% if authorize_for :issue_templates, :new %>
        | <%= link_to l(:label_new_templates),
                    new_project_issue_template_path(@project),
                    :class => 'icon icon-add' %>
      <% end %>
    </p>
  </div>

<h3>Optional settings</h3>
  <p><%= l(:about_help_message) %></p>
  <%= labelled_form_for :settings, @issue_templates_setting, :url => project_issue_templates_settings_path(@project, :tab => :issue_templates), :html => { :id => 'issue_templates_settings' } do |f| %>
    <%= error_messages_for 'issue_templates_setting' %>
    <div class="box tabular">

      <p><%= f.check_box :inherit_templates, :label => l(:label_inherit_templates) %>
        <a class="icon icon-help" href="#" title="<%= l(:help_for_this_field) %>"
           onclick="checkExpand('inherit_templates_help_content'); return false;"><%= l(:help_for_this_field) %>
        </a><br/>
        <span id="inherit_templates_help_content" class="help_content" style="display: none;"><%= l(:label_inherit_templates_help_message) %></span>
      </p>

      <p><%= f.check_box :should_replaced, :label => l(:label_should_replaced) %>
        <a class="icon icon-help" href="#" title="<%= l(:help_for_this_field) %>"
           onclick="checkExpand('should_replaced_help_content'); return false;"><%= l(:help_for_this_field) %>
        </a><br/>
        <span id="should_replaced_help_content" class="help_content" style="display: none;"><%= l(:label_should_replaced_help_message) %></span>
      </p>

    <p><%= f.check_box :enabled, :label => l(:label_show_help_message) %></p>
    <p>
   <%=content_tag(:label, l(:label_help_message)) %>
   <%=text_area_tag 'settings[help_message]',  @issue_templates_setting['help_message'],  :size =>"50x5",
        :class => 'wiki-edit'  %><br/>
   <%= wikitoolbar_for "settings_help_message" %>
   <%= preview_link preview_project_issue_templates_settings_path(@project),
                  'settings_help_message', target='template_help_preview' %>
   <div id="template_help_preview" class="wiki"></div>

    </div>

    <%= submit_tag l(:button_save) %>
<% end %>
</div>
</div>

<script type="text/javascript">
    //<![CDATA[
    function checkExpand(ch) {
        var obj=document.all && document.all(ch) || document.getElementById && document.getElementById(ch);
        if(obj && obj.style) obj.style.display=
                "none" == obj.style.display ?"" : "none"
    }
</script>

